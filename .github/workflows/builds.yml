name: Builders

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  check-release:
    runs-on: ubuntu-latest
    outputs:
      has_release: ${{ steps.release.outputs.has_release }}
      tag_name: ${{ steps.release.outputs.tag_name }}
      release_name: ${{ steps.release.outputs.release_name }}
    steps:
      - name: Get latest release info
        id: release
        run: |
          response=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            https://api.github.com/repos/${{ github.repository }}/releases/latest)

          if echo "$response" | grep -q "Not Found"; then
            echo "has_release=false" >> $GITHUB_OUTPUT
          else
            echo "has_release=true" >> $GITHUB_OUTPUT
            echo "tag_name=$(echo "$response" | jq -r .tag_name)" >> $GITHUB_OUTPUT
            echo "release_name=$(echo "$response" | jq -r .name)" >> $GITHUB_OUTPUT
          fi

  use-release:
    runs-on: ubuntu-latest
    needs: check-release
    steps:
      - name: Print release info
        run: |
          if [ "${{ needs.check-release.outputs.has_release }}" = "true" ]; then
            echo "✅ Latest release tag: ${{ needs.check-release.outputs.tag_name }}"
            echo "📦 Release name: ${{ needs.check-release.outputs.release_name }}"
          else
            echo "⚠️ No releases found."
          fi
